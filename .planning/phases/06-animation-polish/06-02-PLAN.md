---
phase: 06-animation-polish
plan: 02
type: execute
wave: 2
depends_on: ["06-01"]
files_modified:
  - assets/js/animations.js
autonomous: true

must_haves:
  truths:
    - "Sections fade+slide into view on scroll"
    - "Child elements stagger (cascade) when section animates"
    - "Hero title, subtitle, CTA animate in sequence on page load"
    - "Hero background has parallax effect (moves slower than scroll)"
    - "Animations play once and stay visible"
    - "Reduced motion users see instant fades without movement"
  artifacts:
    - path: "assets/js/animations.js"
      provides: "Section reveal animations, hero sequence, parallax"
      min_lines: 150
      contains: "ScrollTrigger"
  key_links:
    - from: "assets/js/animations.js"
      to: ".hero"
      via: "gsap.timeline for hero entrance"
      pattern: "heroTl|hero.*timeline"
    - from: "assets/js/animations.js"
      to: "sections"
      via: "gsap.utils.toArray with ScrollTrigger"
      pattern: "toArray.*section"
---

<objective>
Add scroll-triggered section reveal animations, hero entrance sequence, and hero parallax effect to the animation system.

Purpose: Bring the site to life with dynamic, engaging scroll animations. Sections fade+slide in with staggered child elements, the hero has a dramatic entrance sequence, and parallax adds depth.

Output:
- animations.js extended with section reveals, hero entrance, and parallax
- All animations respect prefers-reduced-motion
</objective>

<execution_context>
@/Users/thuijsmans/.claude/get-shit-done/workflows/execute-plan.md
@/Users/thuijsmans/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/06-animation-polish/06-CONTEXT.md
@.planning/phases/06-animation-polish/06-RESEARCH.md
@.planning/phases/06-animation-polish/06-01-SUMMARY.md
@assets/js/animations.js
@index.html
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add hero entrance sequence animation</name>
  <files>assets/js/animations.js</files>
  <action>
Add the hero entrance sequence to animations.js. This should be added AFTER the existing code (after the WMAnimations export), but still INSIDE the IIFE.

Insert this code before the closing `})();`:

```javascript
  // ==========================================================================
  // Hero Entrance Sequence
  // ==========================================================================
  // Per user decision: dramatic sequence - title, subtitle, CTA animate in sequence
  // Only on pages with .hero section

  const heroSection = document.querySelector('.hero');

  if (heroSection) {
    const heroTitle = heroSection.querySelector('h1');
    const heroSubtitle = heroSection.querySelector('blockquote, .subtitle, p');
    const heroCTA = heroSection.querySelector('.btn-get-started, .d-flex, .cta-buttons');
    const heroBackground = heroSection.querySelector('img');

    // Set initial states to prevent FOUC (use fromTo pattern per research)
    if (!prefersReducedMotion) {
      if (heroTitle) gsap.set(heroTitle, { autoAlpha: 0, y: 50 });
      if (heroSubtitle) gsap.set(heroSubtitle, { autoAlpha: 0, y: 30 });
      if (heroCTA) gsap.set(heroCTA, { autoAlpha: 0, y: 20 });
    }

    // Create entrance timeline
    const heroTl = gsap.timeline({
      delay: 0.3, // Small delay for page to settle
      defaults: {
        ease: window.WMAnimations.config.ease,
        duration: prefersReducedMotion ? 0.1 : 0.5
      }
    });

    if (prefersReducedMotion) {
      // Reduced motion: instant fade, no movement
      if (heroTitle) heroTl.to(heroTitle, { autoAlpha: 1, duration: 0.1 });
      if (heroSubtitle) heroTl.to(heroSubtitle, { autoAlpha: 1, duration: 0.1 }, '-=0.05');
      if (heroCTA) heroTl.to(heroCTA, { autoAlpha: 1, duration: 0.1 }, '-=0.05');
    } else {
      // Full animation: fade + slide sequence
      if (heroTitle) {
        heroTl.to(heroTitle, {
          autoAlpha: 1,
          y: 0,
          duration: 0.6
        });
      }
      if (heroSubtitle) {
        heroTl.to(heroSubtitle, {
          autoAlpha: 1,
          y: 0,
          duration: 0.5
        }, '-=0.3'); // Overlap with previous
      }
      if (heroCTA) {
        heroTl.to(heroCTA, {
          autoAlpha: 1,
          y: 0,
          duration: 0.4
        }, '-=0.2');
      }
    }

    // ==========================================================================
    // Hero Parallax Background
    // ==========================================================================
    // Per user decision: hero background moves slower than content
    // Only apply parallax on desktop and when not reduced motion

    if (heroBackground && !isMobile && !isTouch && !prefersReducedMotion) {
      gsap.to(heroBackground, {
        yPercent: -20, // Background moves 20% relative to scroll
        ease: 'none',
        scrollTrigger: {
          trigger: heroSection,
          start: 'top top',
          end: 'bottom top',
          scrub: 0.5 // Smooth scrub with slight delay
        }
      });
    }
  }
```

Important notes:
- Uses autoAlpha (visibility + opacity) to prevent FOUC
- Sets initial state with gsap.set BEFORE timeline runs
- Reduced motion gets instant fade with no y movement
- Parallax only on desktop, only when not reduced motion
- Uses existing WMAnimations.config for consistent timing
  </action>
  <verify>
Open index.html in browser - hero elements should animate in sequence on page load.
Check with DevTools "Reduce motion" enabled - should fade instantly without sliding.
Scroll down on desktop - hero background should move slower than foreground content.
  </verify>
  <done>
Hero entrance sequence animates title, subtitle, CTA in order with staggered timing. Parallax effect on hero background. Reduced motion support.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add section reveal animations with stagger</name>
  <files>assets/js/animations.js</files>
  <action>
Add section reveal animations to animations.js. Insert this code AFTER the hero section code, still INSIDE the IIFE:

```javascript
  // ==========================================================================
  // Section Reveal Animations
  // ==========================================================================
  // Per user decision: fade + slide up, cascade stagger (50-100ms), play once
  // Animation trigger: 80% visible (Claude's discretion default)

  // Sections to animate - exclude hero (has its own entrance)
  const sections = document.querySelectorAll('section:not(.hero):not(#hero)');

  sections.forEach(section => {
    // Determine if this is a case study page (simplified animations per user decision)
    const isCaseStudy = document.body.classList.contains('portfolio-details-page') ||
                        window.location.pathname.includes('/portfolio/');

    // Find animatable children within the section
    // Cards, list items, columns, content blocks
    const animatableChildren = section.querySelectorAll(
      '.card, .col-lg-4, .col-lg-6, .col-md-6, .testimonial-item, ' +
      '.faq-item, .service-item, .team-member, .stat-item, ' +
      '.info-item, .contact-item, li, article'
    );

    // Determine animation parameters based on section/page context
    const slideDistance = prefersReducedMotion ? 0 : (isCaseStudy ? 0 : 50);
    const duration = prefersReducedMotion ? 0.1 : (isCaseStudy ? 0.2 : 0.35);
    const staggerAmount = prefersReducedMotion ? 0 : (isCaseStudy ? 0 : 0.08);

    // Determine trigger point based on section height (Claude's discretion)
    const sectionHeight = section.offsetHeight;
    let triggerPoint = '80%'; // Default
    if (sectionHeight < 300) {
      triggerPoint = '90%'; // Small sections - trigger earlier
    } else if (sectionHeight > 800) {
      triggerPoint = '70%'; // Large sections - trigger later
    }

    if (animatableChildren.length > 0 && animatableChildren.length <= 20) {
      // Stagger children
      gsap.set(animatableChildren, {
        autoAlpha: 0,
        y: slideDistance
      });

      gsap.to(animatableChildren, {
        autoAlpha: 1,
        y: 0,
        duration: duration,
        ease: window.WMAnimations.config.ease,
        stagger: {
          amount: staggerAmount,
          from: 'start'
        },
        scrollTrigger: {
          trigger: section,
          start: `top ${triggerPoint}`,
          toggleActions: 'play none none none',
          once: true // Play once only - per user decision
        }
      });
    } else {
      // No suitable children or too many - animate section itself
      gsap.set(section, {
        autoAlpha: 0,
        y: slideDistance
      });

      gsap.to(section, {
        autoAlpha: 1,
        y: 0,
        duration: duration,
        ease: window.WMAnimations.config.ease,
        scrollTrigger: {
          trigger: section,
          start: `top ${triggerPoint}`,
          toggleActions: 'play none none none',
          once: true
        }
      });
    }
  });

  // ==========================================================================
  // Card Grid Specific Animations
  // ==========================================================================
  // Portfolio cards in horizontal scroll containers
  const cardContainers = document.querySelectorAll('.cards .row, .cards-portfolio .row');

  cardContainers.forEach(container => {
    const cards = container.querySelectorAll('.card, .col-lg-4');

    if (cards.length > 0) {
      const slideDistance = prefersReducedMotion ? 0 : 50;
      const duration = prefersReducedMotion ? 0.1 : 0.4;

      gsap.set(cards, {
        autoAlpha: 0,
        y: slideDistance
      });

      gsap.to(cards, {
        autoAlpha: 1,
        y: 0,
        duration: duration,
        ease: window.WMAnimations.config.ease,
        stagger: {
          amount: prefersReducedMotion ? 0 : 0.1, // 100ms total across cards
          from: 'start'
        },
        scrollTrigger: {
          trigger: container,
          start: 'top 75%',
          toggleActions: 'play none none none',
          once: true
        }
      });
    }
  });
```

Key implementation notes:
- Excludes hero section (has separate entrance)
- Case study pages get simplified animations per user decision: no slide distance, no stagger, faster duration
- Trigger point varies by section height (Claude's discretion)
- Uses `once: true` so animations don't replay
- Sets initial state with gsap.set to prevent FOUC
- Handles both child stagger and section-level animation based on content
  </action>
  <verify>
Open index.html and scroll down - sections should fade+slide in as they enter viewport.
Cards should animate with stagger effect (one after another).
Open a portfolio case study page - animations should be simpler (just fade, no slide).
Toggle reduced motion in DevTools - animations should be instant fades.
  </verify>
  <done>
Sections fade+slide into view with child element stagger. Case study pages have simplified animations. Reduced motion support. Animations play once and stay visible.
  </done>
</task>

</tasks>

<verification>
After all tasks:
1. Open index.html - hero should animate in sequence on load
2. Scroll down - sections should reveal with fade+slide, children stagger
3. Open portfolio/oeuf.html (case study) - animations should be simpler (fade only, no stagger)
4. Enable "Reduce motion" in system/DevTools - all animations should be instant fades
5. Desktop scroll should feel smooth, parallax visible on hero
6. Refresh page multiple times - animations should be consistent, no flashing/FOUC
7. Console should have no errors
</verification>

<success_criteria>
- Hero entrance sequence works (title -> subtitle -> CTA)
- Hero parallax effect works on desktop
- Section reveal animations work with fade+slide
- Child elements stagger when section animates
- Case study pages have simplified animations
- Reduced motion respected everywhere
- Animations play once and stay visible
- No FOUC (Flash of Unstyled Content)
</success_criteria>

<output>
After completion, create `.planning/phases/06-animation-polish/06-02-SUMMARY.md`
</output>
