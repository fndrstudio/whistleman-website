---
phase: 06-animation-polish
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - index.html
  - services.html
  - portfolio.html
  - contact.html
  - portfolio/oeuf.html
  - portfolio/burgernshake.html
  - portfolio/linguini.html
  - portfolio/locals.html
  - portfolio/pazzi.html
  - "portfolio/inner circle.html"
  - "portfolio/l'OUI.html"
  - assets/js/animations.js
  - assets/css/main.css
autonomous: true

must_haves:
  truths:
    - "Lenis library loads on all pages (desktop only)"
    - "GSAP and ScrollTrigger load on all pages"
    - "Scroll progress bar appears at page top"
    - "No console errors from animation libraries"
    - "Mobile uses native scroll (no Lenis)"
  artifacts:
    - path: "assets/js/animations.js"
      provides: "Animation foundation with Lenis + GSAP setup"
      min_lines: 50
      contains: "new Lenis"
    - path: "assets/css/main.css"
      provides: "Scroll progress bar styles"
      contains: ".scroll-progress"
  key_links:
    - from: "*.html"
      to: "unpkg.com/lenis"
      via: "script tag in head"
      pattern: "lenis.*\\.min\\.js"
    - from: "*.html"
      to: "cdn.jsdelivr.net/npm/gsap"
      via: "script tag in head"
      pattern: "gsap.*\\.min\\.js"
    - from: "assets/js/animations.js"
      to: "Lenis"
      via: "new Lenis instantiation"
      pattern: "new Lenis\\("
---

<objective>
Add Lenis smooth scrolling and GSAP ScrollTrigger libraries to all pages, create the animation foundation, and implement the scroll progress bar.

Purpose: Establish the animation infrastructure that Plans 02 and 03 will build upon. This sets up Lenis (desktop only), GSAP with ScrollTrigger, and the foundational scroll progress indicator.

Output:
- All 11 HTML files updated with CDN script tags
- New animations.js file with Lenis + GSAP foundation
- Scroll progress bar CSS and HTML element
</objective>

<execution_context>
@/Users/thuijsmans/.claude/get-shit-done/workflows/execute-plan.md
@/Users/thuijsmans/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/06-animation-polish/06-CONTEXT.md
@.planning/phases/06-animation-polish/06-RESEARCH.md
@assets/css/main.css
@assets/js/main.js
@index.html
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add CDN scripts and scroll-progress element to all HTML files</name>
  <files>
    index.html, services.html, portfolio.html, contact.html,
    portfolio/oeuf.html, portfolio/burgernshake.html, portfolio/linguini.html,
    portfolio/locals.html, portfolio/pazzi.html, portfolio/inner circle.html, portfolio/l'OUI.html
  </files>
  <action>
Add the following script tags to all 11 HTML files, immediately BEFORE the closing `</head>` tag (after main.css link):

```html
<!-- Lenis Smooth Scroll -->
<link rel="stylesheet" href="https://unpkg.com/lenis@1.3.17/dist/lenis.css">
<script src="https://unpkg.com/lenis@1.3.17/dist/lenis.min.js"></script>

<!-- GSAP Animation -->
<script src="https://cdn.jsdelivr.net/npm/gsap@3.14.1/dist/gsap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/gsap@3.14.1/dist/ScrollTrigger.min.js"></script>
```

Add the scroll progress bar element immediately after the opening `<body ...>` tag on each page:

```html
<div class="scroll-progress" aria-hidden="true"></div>
```

Add the animations.js script reference before the closing `</body>` tag, AFTER main.js:

```html
<script src="assets/js/animations.js"></script>
```

For portfolio/* files, adjust paths to use relative paths:
- `../assets/js/animations.js`

Note: The portfolio folder contains files with spaces in names ("inner circle.html", "l'OUI.html") - handle these carefully.
  </action>
  <verify>
Grep all HTML files for "lenis" and "gsap" script tags, and for "scroll-progress" element.
Open index.html in browser - no 404 errors for CDN scripts in Network tab.
  </verify>
  <done>
All 11 HTML files have Lenis CSS, Lenis JS, GSAP, ScrollTrigger CDN links, scroll-progress div, and animations.js script reference.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create animations.js with Lenis + GSAP foundation</name>
  <files>assets/js/animations.js</files>
  <action>
Create `assets/js/animations.js` with the animation foundation:

```javascript
/**
 * Whistleman Media - Animation System
 * Lenis smooth scroll (desktop only) + GSAP ScrollTrigger
 *
 * User decisions (locked):
 * - Desktop: Butter-smooth scroll with momentum
 * - Mobile: Native scroll (no Lenis)
 * - Progress bar at top
 * - Reduced motion: Simplify animations, keep subtle fades
 */
(function() {
  'use strict';

  // ==========================================================================
  // Device Detection
  // ==========================================================================
  const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
  const isTouch = 'ontouchstart' in window || navigator.maxTouchPoints > 0;
  const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

  // ==========================================================================
  // Lenis Smooth Scroll (Desktop Only)
  // ==========================================================================
  let lenis = null;

  if (!isMobile && !isTouch) {
    lenis = new Lenis({
      duration: 1.2,                // Scroll duration - per user decision: short coast
      easing: (t) => Math.min(1, 1.001 - Math.pow(2, -10 * t)), // Smooth easing
      lerp: 0.1,                    // Linear interpolation - lower = smoother
      wheelMultiplier: 1,           // Mouse wheel sensitivity
      touchMultiplier: 0,           // Disable touch smooth scroll
      infinite: false,
      orientation: 'vertical',
      gestureOrientation: 'vertical',
      smoothWheel: true,
      autoResize: true
    });

    // Expose globally for anchor links
    window.lenis = lenis;

    // Always start at top - per user decision: no scroll position restoration
    if ('scrollRestoration' in history) {
      history.scrollRestoration = 'manual';
    }
    window.scrollTo(0, 0);
  }

  // ==========================================================================
  // GSAP + ScrollTrigger Setup
  // ==========================================================================
  gsap.registerPlugin(ScrollTrigger);

  // Integrate Lenis with ScrollTrigger (critical for sync - per research)
  if (lenis) {
    lenis.on('scroll', ScrollTrigger.update);

    gsap.ticker.add((time) => {
      lenis.raf(time * 1000);
    });

    gsap.ticker.lagSmoothing(0); // Required for Lenis sync
  }

  // ==========================================================================
  // Scroll Progress Bar
  // ==========================================================================
  const progressBar = document.querySelector('.scroll-progress');

  if (progressBar) {
    // Use scaleX for better performance than width
    gsap.set(progressBar, { scaleX: 0, transformOrigin: 'left' });

    gsap.to(progressBar, {
      scaleX: 1,
      ease: 'none',
      scrollTrigger: {
        trigger: document.documentElement,
        start: 'top top',
        end: 'bottom bottom',
        scrub: 0.1
      }
    });
  }

  // ==========================================================================
  // Anchor Link Smooth Scroll
  // ==========================================================================
  document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function(e) {
      const targetId = this.getAttribute('href');
      if (targetId === '#' || targetId === '#0') return; // Skip empty anchors

      const target = document.querySelector(targetId);
      if (!target) return;

      e.preventDefault();

      if (lenis) {
        // Desktop with Lenis - quick snap with easing per user decision
        lenis.scrollTo(target, {
          duration: 1.0,
          easing: (t) => t < 0.5 ? 2 * t * t : -1 + (4 - 2 * t) * t, // ease-in-out
          offset: 0
        });
      } else {
        // Mobile/touch - native smooth scroll
        target.scrollIntoView({
          behavior: 'smooth',
          block: 'start'
        });
      }
    });
  });

  // ==========================================================================
  // Accessibility: matchMedia Setup
  // ==========================================================================
  // This will be used by Plan 02 for section animations
  // Exported pattern for consistency
  window.WMAnimations = {
    lenis: lenis,
    isMobile: isMobile,
    isTouch: isTouch,
    prefersReducedMotion: prefersReducedMotion,
    // Animation config per user decisions
    config: {
      duration: prefersReducedMotion ? 0.1 : 0.3,
      staggerAmount: prefersReducedMotion ? 0 : 0.08, // 80ms between items
      slideDistance: 50,
      ease: 'power2.inOut'
    }
  };

})();
```

Key implementation notes:
- Lenis only on desktop (isMobile + isTouch check) - per user decision
- Duration 1.2 for "short coast" momentum feel
- scrollRestoration manual to always start at top - per user decision
- Progress bar uses scaleX (GPU accelerated) not width
- Anchor links use Lenis on desktop, native scrollIntoView on mobile
- Exposes WMAnimations global for Plan 02 to use
  </action>
  <verify>
Open browser console, type `window.WMAnimations` - should return object with lenis, config properties.
On desktop: scroll should feel smooth with momentum.
On mobile/DevTools mobile view: scroll should be native (check `window.lenis` is null).
  </verify>
  <done>
animations.js exists with Lenis setup (desktop only), GSAP+ScrollTrigger integration, scroll progress bar animation, and anchor link smooth scroll.
  </done>
</task>

<task type="auto">
  <name>Task 3: Add scroll progress bar CSS and visibility utility</name>
  <files>assets/css/main.css</files>
  <action>
Add the following CSS to main.css. Add at the end of the file, before any closing comments:

```css
/*--------------------------------------------------------------
# Animation Utilities (Phase 6)
--------------------------------------------------------------*/

/* Scroll Progress Bar - subtle per user decision */
.scroll-progress {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 3px;
  background: var(--accent-color);
  transform-origin: left;
  transform: scaleX(0);
  z-index: 99999;
  pointer-events: none;
}

/* Visibility utility for GSAP animations - prevents FOUC */
.gs-hidden {
  visibility: hidden;
  opacity: 0;
}

/* Reduced motion: hide progress bar movement indicator */
@media (prefers-reduced-motion: reduce) {
  .scroll-progress {
    /* Keep visible but no animation would be jarring */
    transform: scaleX(1);
    opacity: 0.3;
  }
}
```

Note: The progress bar is 3px height, uses var(--accent-color) which is #ff5733 per the existing CSS variables, and has z-index 99999 to stay above everything including the popup (z-index 1000000).
  </action>
  <verify>
Grep main.css for ".scroll-progress" - should find the new styles.
Open index.html in browser - thin orange progress bar should appear at top and grow as you scroll.
  </verify>
  <done>
main.css has scroll-progress styles, gs-hidden utility class, and reduced motion media query for animations.
  </done>
</task>

</tasks>

<verification>
After all tasks:
1. Open index.html in browser
2. Check Network tab - Lenis and GSAP should load without 404
3. Check Console - no errors
4. Scroll down - progress bar should grow from left to right
5. On desktop - scroll should feel smooth with momentum
6. Toggle DevTools mobile view - scroll should revert to native
7. Click any anchor link (if present) - should smooth scroll to target
8. Console: `window.WMAnimations` should return configuration object
</verification>

<success_criteria>
- All 11 HTML files have CDN scripts for Lenis and GSAP
- animations.js created with Lenis (desktop), GSAP ScrollTrigger, progress bar
- Scroll progress bar visible and functional
- No console errors
- Mobile uses native scroll
- Foundation ready for Plan 02 (section animations) and Plan 03 (micro-interactions)
</success_criteria>

<output>
After completion, create `.planning/phases/06-animation-polish/06-01-SUMMARY.md`
</output>
