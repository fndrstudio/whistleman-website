---
phase: 02-image-optimization
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - assets/img/**/*.webp (created)
  - index.html
  - services.html
  - portfolio.html
  - contact.html
  - portfolio/burgernshake.html
  - portfolio/inner circle.html
  - portfolio/l'OUI.html
  - portfolio/linguini.html
  - portfolio/locals.html
  - portfolio/oeuf.html
  - portfolio/pazzi.html
autonomous: false

must_haves:
  truths:
    - "All images load as WebP format (visible in browser network tab)"
    - "Below-fold images load lazily (deferred in network waterfall)"
    - "Total image payload under 30MB (from 219MB)"
  artifacts:
    - path: "assets/img/**/*.webp"
      provides: "WebP versions of all JPG/PNG images"
    - path: "index.html"
      provides: "Updated img src to .webp, lazy loading on below-fold images"
      contains: 'loading="lazy"'
    - path: "portfolio/*.html"
      provides: "Updated img src to .webp, lazy loading on below-fold images"
  key_links:
    - from: "HTML img tags"
      to: ".webp files"
      via: "src attribute references"
      pattern: 'src="[^"]+\\.webp"'
    - from: "Below-fold images"
      to: "Browser lazy loading"
      via: "loading attribute"
      pattern: 'loading="lazy"'
---

<objective>
Optimize all images for fast web loading through format conversion, resizing, and lazy loading.

Purpose: Reduce page load time by converting 219MB of images to properly sized WebP format and deferring below-fold image loading.
Output: WebP versions of all images, updated HTML references, lazy loading on below-fold images.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
@~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-critical-cleanup/01-01-SUMMARY.md

Current state:
- 152 images: 73 PNG, 73 JPG (including 5 uppercase .JPG), 4 SVG, 2 WebP
- Total size: 219MB
- Largest images: 19MB, 5306x7955px (way oversized for web)
- Only 4 images have loading="lazy" currently
- No srcset/responsive images

Tools available:
- sips (macOS native) - supports WebP conversion and resizing
- No npm/build system (project constraint)

Target:
- Max image width: 2000px (sufficient for 4K displays)
- Format: WebP (97%+ browser support)
- Size target: Under 30MB total
</context>

<tasks>

<task type="auto">
  <name>Task 1: Resize and convert images to WebP</name>
  <files>assets/img/**/*.webp (created), assets/img/**/*.jpg, assets/img/**/*.png</files>
  <action>
Create and run a bash script that:

1. Finds all JPG and PNG files in assets/img/ (recursively)
2. For each image:
   - Get current dimensions with `sips -g pixelWidth`
   - If width > 2000px, resize to 2000px wide maintaining aspect ratio: `sips --resampleWidth 2000`
   - Convert to WebP: `sips -s format webp <input> --out <output.webp>`
3. Keep original files (for fallback/source)
4. Handle filenames with spaces (common in this project)
5. Skip SVG files (vector, don't convert)
6. Skip existing .webp files

Script approach:
```bash
find assets/img -type f \( -iname "*.jpg" -o -iname "*.jpeg" -o -iname "*.png" \) | while read -r img; do
  webp="${img%.*}.webp"
  # Get width
  width=$(sips -g pixelWidth "$img" 2>/dev/null | grep pixelWidth | awk '{print $2}')
  # Create temp resized if needed, then convert to webp
  if [ "$width" -gt 2000 ]; then
    sips --resampleWidth 2000 "$img" --out /tmp/resized_temp.jpg
    sips -s format webp /tmp/resized_temp.jpg --out "$webp"
    rm /tmp/resized_temp.jpg
  else
    sips -s format webp "$img" --out "$webp"
  fi
done
```

Important:
- Use quotes around paths for filenames with spaces
- Check sips exit code for errors
- Process subdirectories (cases/*, clients/*)
  </action>
  <verify>
- Count WebP files created: `find assets/img -name "*.webp" | wc -l` should be ~141 (excluding SVG, existing webp)
- Check total WebP size: `du -sh assets/img` should show significant reduction
- Verify no errors in conversion: spot-check a few large originals have WebP counterparts
  </verify>
  <done>
- WebP file exists for every JPG/PNG in assets/img/
- All WebP files are 2000px or narrower
- Total image directory size significantly reduced
  </done>
</task>

<task type="auto">
  <name>Task 2: Update HTML with WebP sources and lazy loading</name>
  <files>index.html, services.html, portfolio.html, contact.html, portfolio/*.html</files>
  <action>
Update all 11 HTML files to use WebP images and add lazy loading:

1. **Change image extensions from .jpg/.png to .webp:**
   - Find: `src="assets/img/...\.jpg"` or `src="assets/img/...\.png"`
   - Replace with: `src="assets/img/....webp"`
   - Handle both lowercase and uppercase extensions (.JPG, .PNG)
   - Do NOT change SVG files

2. **Add lazy loading to below-fold images:**
   - Add `loading="lazy"` to all img tags EXCEPT:
     - Hero images (first visible image on page, usually in .hero section)
     - Logo images (header)
     - Above-fold content images
   - Rule of thumb: First 1-2 images per page load eagerly, rest lazy

3. **Preserve existing attributes:**
   - Keep class, alt, style attributes unchanged
   - Only modify src and add loading attribute

Files and image counts:
- index.html (54 img tags) - hero-bg-wmm is above-fold
- services.html (18 img tags) - hero-services-wmm is above-fold
- portfolio.html (19 img tags) - first portfolio thumbnails may be above-fold
- contact.html (5 img tags) - minimal images
- portfolio/*.html (25-29 each) - banner images are above-fold

Example transformation:
Before: `<img src="assets/img/cases/locals.jpg" class="img-fluid" alt="">`
After: `<img src="assets/img/cases/locals.webp" class="img-fluid" alt="" loading="lazy">`
  </action>
  <verify>
- grep for remaining .jpg/.png src in HTML files (should be 0 except SVG)
- grep for loading="lazy" count (should be majority of images)
- npm run dev or python -m http.server and check browser DevTools Network tab
  </verify>
  <done>
- All img src attributes reference .webp files (except SVG)
- Below-fold images have loading="lazy" attribute
- No broken image references
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>All images converted to WebP and HTML updated with lazy loading</what-built>
  <how-to-verify>
1. Start local server: `python3 -m http.server 8000`
2. Visit: http://localhost:8000
3. Open DevTools → Network tab → filter by "Img"
4. Refresh page (clear cache first: Cmd+Shift+R)
5. Verify:
   - All image requests show .webp extension
   - Total transferred size is much smaller than before
   - Below-fold images show "(pending)" initially, load on scroll
6. Scroll down the page slowly
7. Verify:
   - Images appear as you scroll (lazy loading working)
   - No broken images (no 404s in network tab)
   - Image quality is acceptable (no visible compression artifacts)
8. Check a portfolio case page (e.g., http://localhost:8000/portfolio/locals)
   - Banner image loads immediately
   - Gallery images lazy load on scroll
  </how-to-verify>
  <resume-signal>Type "approved" if images display correctly, or describe any issues (broken images, quality problems, missing lazy loading)</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] WebP file count matches original JPG/PNG count (~141 files)
- [ ] Total assets/img size under 30MB (from 219MB)
- [ ] All HTML files reference .webp (grep shows no .jpg/.png src)
- [ ] Browser DevTools confirms WebP loading and lazy behavior
- [ ] No broken images on any page
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Human verified images display correctly
- PERF-01 met: All images in WebP format
- PERF-02 met: Below-fold images lazy load
- Total image size under 30MB target
</success_criteria>

<output>
After completion, create `.planning/phases/02-image-optimization/02-01-SUMMARY.md`
</output>
